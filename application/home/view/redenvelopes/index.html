<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
    <head>
    　　<title>{$title}</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="Content-Language" content="zh-CN" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <style>
            html,body{
                height: 100%;
                width: 100%;
                overflow: hidden;
            }

            *{
                padding: 0;
                margin: 0;
            }

            body {
                background: #f44336;
                background-image: url('');
                background-repeat: no-repeat;
                background-size: 100% 100%;
            }

            img{
                position: absolute;
                top: 0;
                left: 0;
                right: 0;;
                bottom: 0;
                object-fit: cover;
                object-position: center;
                z-index: -1;
                height: 100%;
                width: 100%;
            }

            #content {
                text-align: center;
                color: #ffc107;
            }

            .receive {
                width: 120px;
                height: 120px;
                background: #ffc107;
                border-radius: 120px;;
                color: #f44336;
                line-height: 120px;
                margin: 30% auto;
                font-size: 24px;
                cursor: crosshair;
            }
        </style>
    </head>
    <body id="content">
        <!-- <img src="http://img5.niutuku.com/phone/1212/1614/1614-niutuku.com-102114.jpg" alt=""> -->
        <h1>{$title}</h1>

        <div class="receive">领取红包</div>
    </body>

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js" type="text/javascript" charset="utf-8"></script>

    <script type="text/javascript" charset="utf-8">
        var appid = "{$appid}";
        var company_id = "{$company_id}";
        var share_title = "{$share_title}";
        var share_cover = "{$share_cover}";
        var share_url = "{$share_url}";
        var activity_id = "{$activity_id}";
        var wx_obj;

        function GetQueryString(name){
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if(r!=null)return  unescape(r[2]); return null;
        }

        $.get('/home/Redenvelopes/getJsSdk', {appid:appid, company_id:company_id, url:window.location.href}, function(result){
            wx_obj = result.body;
            wx.config(wx_obj);

            wx.ready(function () {
                //分享到朋友圈
                wx.onMenuShareTimeline({
                    title: share_title,
                    link: share_url,
                    imgUrl: share_cover,
                    success: function () {
                        alert("分享成功");

                        $.post('/home/Redenvelopes/setShare', {appid: appid, activity_id: activity_id}, function(result){
                        });
                    },
                    cancel: function () {
                        //alert("取消分享到朋友圈");
                        // 用户取消分享后执行的回调函数
                    }
                });
            });
        });

        $(".receive").click(function(){
            $.post('/home/Redenvelopes/receive', {code: GetQueryString('code')}, function(result){
                if(result.meta.code == 3001){
                    window.location.href = result.body.jump_url;
                }

                alert(result.meta.message);
            });
        });
    </script>
</html>