<!DOCTYPE html>
<html lang="en">
    <head>

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="Content-Language" content="zh-CN" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>{$title}</title>
        <style>
            html,body{
                height: 100%;
                width: 100%;
                overflow: hidden;
            }

            *{
                padding: 0;
                margin: 0;
            }

            body {
                background-image: url('');
                background-repeat: no-repeat;
                background-size: 100% 100%;
            }

            img{
                width: 100%;
            }

            .receive {
                position: fixed;
                width: 100%;
                height: 60px;
                background: #ffc107;
                color: #f44336;
                left: 0;
                bottom: 0;
                z-index: 100;
                line-height: 60px;
                text-align: center;
                font-size: 24px;
                cursor: crosshair;
            }
        </style>
    </head>
    <body>


        <div style="overflow: auto;height: 100%;width: 100%;position: relative">
            <h1 style="text-align:center; background: #ffc107; color: #f44336;">{$title}</h1>
            {foreach name="background" id="vo" }
                <img src="{$vo}" alt="" style="vertical-align: top">
            {/foreach}
            <div class="receive">领取红包</div>
        </div>








        <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js" type="text/javascript" charset="utf-8"></script>

        <script type="text/javascript" charset="utf-8">
          var appid = "{$appid}";
          var company_id = "{$company_id}";
          var share_title = "{$share_title}";
          var share_cover = "{$share_cover}";
          var share_url = "{$share_url}";
          var activity_id = "{$activity_id}";
          var wx_obj;
          var is_loding = false;

          function GetQueryString(name){
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if(r!=null)return  unescape(r[2]); return null;
          }

          $.get('/home/Redenvelopes/getJsSdk', {appid:appid, company_id:company_id, url:window.location.href}, function(result){
            wx_obj = result.body;
            wx.config(wx_obj);

            wx.ready(function () {
              //分享到朋友圈
              wx.onMenuShareTimeline({
                title: share_title,
                link: share_url,
                imgUrl: share_cover,
                success: function () {
                  alert("分享成功");

                  $.post('/home/Redenvelopes/setShare', {appid: appid, activity_id: activity_id}, function(result){
                  });
                },
                cancel: function () {
                  // alert("取消分享到朋友圈");
                  // 用户取消分享后执行的回调函数
                }
              });
            });
          });

          $(".receive").click(function(){
            if(is_loding){
                return;
            }

            is_loding = true;

            $(this).text('正在领取中...');

            $.post('/home/Redenvelopes/receive', {code: GetQueryString('code')}, function(result){
              if(result.meta.code == 3001){
                window.location.href = result.body.jump_url;
              }

              is_loding = false;
              $(".receive").text('领取红包');

              alert(result.meta.message);
            });
          });
        </script>
    </body>
</html>